# AI Local Server - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## –û–ø–∏—Å–∞–Ω–∏–µ
–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Yandex GPT —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —á–∞—Ç–æ–≤** - –≤—Å–µ —á–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —á–∞—Ç–∞–º–∏** - —Å–æ–∑–¥–∞–Ω–∏–µ, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- **Streaming –æ—Ç–≤–µ—Ç–æ–≤** - —Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∫–∞–∫ –≤ ChatGPT/DeepSeek
- **Multi-Agent —Å–∏—Å—Ç–µ–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- **–°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ (–∫–∞–∫ –≤ Claude Code)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
AiLocalServer/
‚îú‚îÄ‚îÄ src/main/kotlin/kz/shprot/
‚îÇ   ‚îú‚îÄ‚îÄ Main.kt                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, Ktor —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ YandexLLMClient.kt         # –ö–ª–∏–µ–Ω—Ç –¥–ª—è Yandex API
‚îÇ   ‚îú‚îÄ‚îÄ ChatHistory.kt             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π —á–∞—Ç–æ–≤ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ DatabaseManager.kt         # –ú–µ–Ω–µ–¥–∂–µ—Ä SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–æ–≤–æ–µ!)
‚îÇ   ‚îú‚îÄ‚îÄ AgentManager.kt            # Multi-Agent —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ ContextCompressor.kt       # –°–∏—Å—Ç–µ–º–∞ —Å–∂–∞—Ç–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îÇ       ‚îú‚îÄ‚îÄ YandexApiModels.kt     # –ú–æ–¥–µ–ª–∏ –¥–ª—è Yandex API
‚îÇ       ‚îú‚îÄ‚îÄ WebApiModels.kt        # –ú–æ–¥–µ–ª–∏ –¥–ª—è –≤–µ–± API
‚îÇ       ‚îî‚îÄ‚îÄ AgentModels.kt         # –ú–æ–¥–µ–ª–∏ –¥–ª—è multi-agent —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ src/main/resources/static/
‚îÇ   ‚îî‚îÄ‚îÄ index.html                 # –í–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å sidebar –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —á–∞—Ç–∞–º–∏
‚îú‚îÄ‚îÄ .claude/
‚îÇ   ‚îî‚îÄ‚îÄ claude.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env.example                   # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ chats.db                       # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Main.kt
- –ó–∞–ø—É—Å–∫ Ktor —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 8080
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `DatabaseManager`, `ChatHistory`, `YandexLLMClient` –∏ `AgentManager`
- –ú–∞—Ä—à—Ä—É—Ç—ã:
  - `GET /` - –æ—Ç–¥–∞—á–∞ HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  - `GET /api/chats` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ (–Ω–æ–≤–æ–µ!)
  - `POST /api/chats` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ (–Ω–æ–≤–æ–µ!)
  - `DELETE /api/chats/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ (–Ω–æ–≤–æ–µ!)
  - `GET /api/chats/{id}/messages` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ (–Ω–æ–≤–æ–µ!)
  - `POST /api/chat` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (—Å multi-agent, —Ç–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç chatId)
  - `POST /api/chat/stream` - streaming —Ä–µ–∂–∏–º

### 2. YandexLLMClient.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Yandex GPT API

**–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:**
- `apiKey: String` - API –∫–ª—é—á Yandex Cloud
- `modelUri: String` - URI –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "gpt://folder_id/yandexgpt/latest")

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `sendMessage(messages: List<Message>): String` - –æ–±—ã—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É)
- `sendMessageWithHistory(messages: List<Message>): LLMStructuredResponse` - —Å JSON Schema –ø–∞—Ä—Å–∏–Ω–≥–æ–º
- `sendMessageStream(messages: List<Message>): Flow<String>` - **streaming —Ä–µ–∂–∏–º** (–Ω–æ–≤–æ–µ!)

**Streaming —Ä–µ–∂–∏–º:**
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ –º–µ—Ä–µ –µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–∫–∞–∫ –≤ ChatGPT/DeepSeek):
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `stream: true` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∑–∞–ø—Ä–æ—Å–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Flow<String>` —Å –∫—É—Å–∫–∞–º–∏ —Ç–µ–∫—Å—Ç–∞
- –ü–∞—Ä—Å–∏—Ç Server-Sent Events (SSE) –æ—Ç Yandex API
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í streaming —Ä–µ–∂–∏–º–µ JSON Schema –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π: `Message(role: String, text: String)`
- –†–æ–ª–∏: "system", "user", "assistant"
- `jsonObject: true` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ)
- Fallback –Ω–∞ plain text –µ—Å–ª–∏ JSON –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª—Å—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `runCatching` –≤–º–µ—Å—Ç–æ try/catch (Kotlin idiomatic)

### 3. DatabaseManager.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Ç–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:**
- –¢–∞–±–ª–∏—Ü–∞ `chats`:
  - `id` (INTEGER PRIMARY KEY) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —á–∞—Ç–∞
  - `title` (TEXT) - –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞
  - `created_at` (INTEGER) - timestamp —Å–æ–∑–¥–∞–Ω–∏—è
  - `updated_at` (INTEGER) - timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –¢–∞–±–ª–∏—Ü–∞ `messages`:
  - `id` (INTEGER PRIMARY KEY)
  - `chat_id` (INTEGER) - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ chats
  - `role` (TEXT) - —Ä–æ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è ("user", "assistant", "system")
  - `content` (TEXT) - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  - `timestamp` (INTEGER) - timestamp —Å–æ–æ–±—â–µ–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `createChat(title): Int` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç chatId
- `getAllChats(): List<ChatData>` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ updated_at DESC)
- `getChat(chatId): ChatData?` - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–∞ –ø–æ ID
- `deleteChat(chatId): Boolean` - —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ (CASCADE —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
- `saveMessage(chatId, role, content): Boolean` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `getMessages(chatId): List<MessageData>` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
- `updateChatTimestamp(chatId)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `updateChatTitle(chatId, title): Boolean` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —á–∞—Ç–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ò–Ω–¥–µ–∫—Å –Ω–∞ `chat_id` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- CASCADE DELETE –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —á–∞—Ç–∞
- Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î

### 4. ChatHistory.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π —á–∞—Ç–æ–≤ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å `DatabaseManager` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (`ConcurrentHashMap<Int, ChatContext>`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞ –∏–∑ –ë–î –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `createChat(title): Int` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
- `getAllChats(): List<ChatData>` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- `deleteChat(chatId): Boolean` - —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞
- `loadChat(chatId)` - –∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞ –∏–∑ –ë–î –≤ –ø–∞–º—è—Ç—å
- `addMessage(chatId, role, content)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –∏ –≤ –ø–∞–º—è—Ç–∏)
- `getMessages(chatId): List<Message>` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
- `buildMessagesWithHistory(chatId, userMessage)` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–ª—è LLM
- `buildMessagesWithCompression(chatId, userMessage, ...)` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Å–∂–∞—Ç–∏—è
- `getCompressionInfo(chatId): CompressionInfo?` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∂–∞—Ç–∏–∏
- `updateCompressionInfo(chatId, compressionInfo)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∂–∞—Ç–∏–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç title —á–∞—Ç–∞ (–ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∂–∞—Ç–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, –Ω–µ –≤ –ë–î)
- Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `ConcurrentHashMap`
- Lazy loading - —á–∞—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω

### 4. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### YandexApiModels.kt (OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç)

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
- `OpenAIMessage(role, content)` - —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ OpenAI —Ñ–æ—Ä–º–∞—Ç–µ
- `OpenAIChatCompletionRequest` - –∑–∞–ø—Ä–æ—Å –∫ API –≤ OpenAI —Ñ–æ—Ä–º–∞—Ç–µ:
  - `model: String` - –∏–º—è –º–æ–¥–µ–ª–∏
  - `messages: List<OpenAIMessage>` - —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
  - `temperature: Double` - –ø–∞—Ä–∞–º–µ—Ç—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  - `maxTokens: Int` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
  - `responseFormat: ResponseFormat?` - —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (JSON Schema)

**JSON Schema –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:**
- `ResponseFormat` - –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è JSON Schema
- `JsonSchemaDefinition` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã —Å –∏–º–µ–Ω–µ–º –∏ —Ñ–ª–∞–≥–æ–º strict
- `JsonSchema` - –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—ä–µ–∫—Ç–∞
- `JsonSchemaProperty` - —Å–≤–æ–π—Å—Ç–≤–æ —Å—Ö–µ–º—ã

**–û—Ç–≤–µ—Ç—ã –æ—Ç API:**
- `OpenAIChatCompletionResponse` - –æ—Ç–≤–µ—Ç –æ—Ç API:
  - `choices: List<Choice>` - –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
  - `usage: Usage?` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- `Choice` - –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- `Usage` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

#### WebApiModels.kt
**–ú–æ–¥–µ–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API:**
- `ChatRequest(message, chatId, temperature, compressContext, compressSystemPrompt)` - –∑–∞–ø—Ä–æ—Å –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
  - ‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `chatId: Int` –≤–º–µ—Å—Ç–æ `sessionId: String`
- `ChatResponse(response, title, isMultiAgent, agents, tokenUsage, contextWindowUsage)` - –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
  - `isMultiAgent: Boolean` - —Ñ–ª–∞–≥ multi-agent —Ä–µ–∂–∏–º–∞
  - `agents: List<AgentResponseData>?` - –æ—Ç–≤–µ—Ç—ã –æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (–µ—Å–ª–∏ multi-agent)
- `AgentResponseData(role, content)` - –æ—Ç–≤–µ—Ç –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- `LLMStructuredResponse(title, message)` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç LLM

**–ú–æ–¥–µ–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏ (–Ω–æ–≤–æ–µ!):**
- `Chat(id, title, createdAt, updatedAt)` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ
- `ChatListResponse(chats)` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- `CreateChatRequest(title)` - –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
- `CreateChatResponse(chatId, title)` - –æ—Ç–≤–µ—Ç —Å ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —á–∞—Ç–∞
- `ChatMessage(id, chatId, role, content, timestamp)` - —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –ë–î
- `MessagesResponse(messages)` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞

### 5. AgentManager.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ multi-agent —Å–∏—Å—Ç–µ–º–æ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Multi-Agent —Å–∏—Å—Ç–µ–º–∞:**
1. **–ê–Ω–∞–ª–∏–∑ –≤–æ–ø—Ä–æ—Å–∞** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω—ã –ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
2. **–°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã (—Ñ–∏–∑–∏–∫, —ç–∫–æ–Ω–æ–º–∏—Å—Ç –∏ —Ç.–¥.)
3. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è** - –∫–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç, –≤–∏–¥—è –æ—Ç–≤–µ—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö
4. **–°–∏–Ω—Ç–µ–∑** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å–æ–±–∏—Ä–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ –≤—Å–µ—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `analyzeQuestion()` - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω—É–∂–Ω—ã –ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
- `createAgent()` - —Å–æ–∑–¥–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ —Å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º system prompt
- `consultAgent()` - –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
- `synthesizeResponse()` - —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- `processMessage()` - –≥–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π + —è–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
- `processMessageStream()` - **streaming —Ä–µ–∂–∏–º** (–±–µ–∑ multi-agent –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)

**–¢–∏–ø—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:**
- –ù–∞—É—á–Ω—ã–µ: —Ñ–∏–∑–∏–∫, –º–∞—Ç–µ–º–∞—Ç–∏–∫, –±–∏–æ–ª–æ–≥, —Ö–∏–º–∏–∫
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ: —Ç–µ—Ä–∞–ø–µ–≤—Ç, —Ö–∏—Ä—É—Ä–≥, –∫–∞—Ä–¥–∏–æ–ª–æ–≥, –æ—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ: —ç–∫–æ–Ω–æ–º–∏—Å—Ç, —é—Ä–∏—Å—Ç, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –∏–Ω–∂–µ–Ω–µ—Ä
- –ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ: –∏—Å—Ç–æ—Ä–∏–∫, —Ñ–∏–ª–æ—Å–æ—Ñ, —Å–æ—Ü–∏–æ–ª–æ–≥

**–Ø–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —è–≤–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤:
- "–°–æ–∑–¥–∞–π —Ñ–∏–∑–∏–∫–∞ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞"
- "–ü–æ–∑–æ–≤–∏ —ç–∫–æ–Ω–æ–º–∏—Å—Ç–∞ –∏ —é—Ä–∏—Å—Ç–∞"
- "–ù—É–∂–µ–Ω –≤—Ä–∞—á-—Ç–µ—Ä–∞–ø–µ–≤—Ç"

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è:**
- ‚úÖ –í–æ–ø—Ä–æ—Å –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–π (—Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π)
- ‚úÖ –í–æ–ø—Ä–æ—Å —Å–ª–æ–∂–Ω—ã–π –∏ –º–Ω–æ–≥–æ–∞—Å–ø–µ–∫—Ç–Ω—ã–π
- ‚ùå –ü—Ä–æ—Å—Ç–æ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å
- ‚ùå –£—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –≤ –¥–∏–∞–ª–æ–≥–µ

### 6. AgentModels.kt
**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è multi-agent —Å–∏—Å—Ç–µ–º—ã:**
- `Agent` - –∞–≥–µ–Ω—Ç-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º system prompt
- `AgentAnalysis` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ (–Ω—É–∂–Ω—ã –ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã)
- `SpecialistInfo` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
- `AgentResponse` - –æ—Ç–≤–µ—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- `MultiAgentResponse` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ –≤—Å–µ–º–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è–º–∏

### 7. index.html
**–í–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —á–∞—Ç–∞–º–∏:**

**Layout:**
- Sidebar —Å–ª–µ–≤–∞ (280px) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
- Main content —Å–ø—Ä–∞–≤–∞ - —á–∞—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**Sidebar (–Ω–æ–≤–æ–µ!):**
- –ö–Ω–æ–ø–∫–∞ "+ –ù–æ–≤—ã–π —á–∞—Ç" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ —Å:
  - –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è)
  - –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ: "—Ç–æ–ª—å–∫–æ —á—Ç–æ", "5 –º–∏–Ω. –Ω–∞–∑–∞–¥")
  - –ê–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –≤—ã–¥–µ–ª–µ–Ω —Å–∏–Ω–∏–º —Ü–≤–µ—Ç–æ–º
  - –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (üóëÔ∏è) –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —á–∞—Ç–æ–≤

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Markdown (marked.js)
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–¥–∞ (highlight.js)
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ title –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **Multi-agent —Ä–µ–∂–∏–º:**
  - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è multi-agent –æ—Ç–≤–µ—Ç–æ–≤
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∫–∞–∂–¥–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
  - –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞
  - –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ä–∞–∑–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ (–Ω–æ–≤–æ–µ!):**
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ - POST /api/chats
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Ç–∞ - –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ GET /api/chats/{id}/messages
- –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º - DELETE /api/chats/{id}
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —á–∞—Ç –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç

**State Management:**
- `currentChatId` - ID —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞
- `chats` - –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —á–∞—Ç–∞ - –æ—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ –ë–î
- –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —á–∞—Ç–∞

### 8. ContextCompressor.kt
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

**–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
- `CompressionInfo` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∂–∞—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–∞:
  - `compressedUpToIndex` - –¥–æ –∫–∞–∫–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ —Å–∂–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏—è
  - `compressedSummary` - —Å–∂–∞—Ç–æ–µ —Ä–µ–∑—é–º–µ –¥–∏–∞–ª–æ–≥–∞
  - `compressedSystemPrompt` - —Å–∂–∞—Ç—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `compressMessages()` - —Å–∂–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
- `compressSystemPrompt()` - —Å–∂–∏–º–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- `createOrUpdateCompression()` - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–∂–∞—Ç–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
1. –ö–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∂–∞—Ç–∏–µ
2. –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤—Å–µ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ) –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è LLM –¥–ª—è —Å–∂–∞—Ç–∏—è
3. LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–∏–∞–ª–æ–≥–∞ (—Å–∂–∞—Ç–∏–µ –≤ 5-10 —Ä–∞–∑)
4. –†–µ–∑—é–º–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `CompressionInfo`
5. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö LLM –ø–æ–ª—É—á–∞–µ—Ç: `[system_prompt?, compressed_summary, last_message, new_message]`
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ UI (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ (–¥–æ 85-90%)
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Å—Ç–∏ –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ UI

**UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–≤–∞ —Ç—É–º–±–ª–µ—Ä–∞ –≤ –≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:
  - "–°–∂–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∫–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ)" - –≥–ª–∞–≤–Ω—ã–π —Ç—É–º–±–ª–µ—Ä
  - "–°–∂–∏–º–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç" - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–µ—Ä–≤–æ–≥–æ
- –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ç—É–º–±–ª–µ—Ä –≤—ã–∫–ª—é—á–µ–Ω, –≤—Ç–æ—Ä–æ–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Multi-Agent —Å–∏—Å—Ç–µ–º–∞ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä + —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "—Ç–µ—Ä–∞–ø–µ–≤—Ç + —É–∑–∫–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã":
- –ë–∞–∑–æ–≤—ã–π –∞–≥–µ–Ω—Ç (—Ç–µ—Ä–∞–ø–µ–≤—Ç) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
- –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É—é—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤–∏–¥–∏—Ç –æ—Ç–≤–µ—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫ –∫–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä—ã–Ω–∫–∏?"

1. –ê–Ω–∞–ª–∏–∑ ‚Üí "—Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –Ω—É–∂–Ω—ã —Ñ–∏–∑–∏–∫ + —ç–∫–æ–Ω–æ–º–∏—Å—Ç"
2. –§–∏–∑–∏–∫ –æ—Ç–≤–µ—á–∞–µ—Ç: "–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∫–≤–∞–Ω—Ç–æ–≤–æ–π —Ñ–∏–∑–∏–∫–∏..."
3. –≠–∫–æ–Ω–æ–º–∏—Å—Ç –≤–∏–¥–∏—Ç –æ—Ç–≤–µ—Ç —Ñ–∏–∑–∏–∫–∞ –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç: "–£—á–∏—Ç—ã–≤–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞—Å–ø–µ–∫—Ç..."
4. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç: "–ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π —ç–∫—Å–ø–µ—Ä—Ç–æ–≤..."
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:**
- ‚úÖ –ê–≥–µ–Ω—Ç—ã —Å—Ç—Ä–æ—è—Ç –Ω–∞ –æ—Ç–≤–µ—Ç–∞—Ö –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- ‚úÖ –ë–æ–ª–µ–µ —Å–≤—è–∑–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- ‚úÖ –ú–µ–Ω—å—à–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –º–µ–∂–¥—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- –ü—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å = 1 API –∑–∞–ø—Ä–æ—Å
- –°–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å (3 –∞–≥–µ–Ω—Ç–∞) = 5 API –∑–∞–ø—Ä–æ—Å–æ–≤:
  - 1 –∞–Ω–∞–ª–∏–∑
  - 3 –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
  - 1 —Å–∏–Ω—Ç–µ–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

### Streaming –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∫ –≤ ChatGPT/DeepSeek)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
–í–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, —Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ –º–µ—Ä–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Backend: Server-Sent Events (SSE) —á–µ—Ä–µ–∑ Ktor
- API: Yandex API —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `stream: true`
- Frontend: Fetch API —Å ReadableStream
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π markdown —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/chat/stream`
2. –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. YandexLLMClient –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Ç–æ–∫ –∫—É—Å–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞ –æ—Ç API
4. –ö–∞–∂–¥—ã–π –∫—É—Å–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É –∫–∞–∫ SSE —Å–æ–±—ã—Ç–∏–µ: `data: {"chunk": "—Ç–µ–∫—Å—Ç"}`
5. UI –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç markdown
6. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `data: {"done": true}`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–≤–∞—è —Ä–µ–∞–∫—Ü–∏—è (—Ç–µ–∫—Å—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å—Ä–∞–∑—É)
- ‚úÖ –õ—É—á—à–∏–π UX (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å)
- ‚úÖ –û—â—É—â–µ–Ω–∏–µ "–∂–∏–≤–æ–≥–æ" –¥–∏–∞–ª–æ–≥–∞

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå –í streaming —Ä–µ–∂–∏–º–µ multi-agent —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
- ‚ùå JSON Schema –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ streaming —Ä–µ–∂–∏–º–µ
- ‚ÑπÔ∏è –î–ª—è multi-agent –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º `/api/chat`

**–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞:**
- Streaming (`/api/chat/stream`) - –±—ã—Å—Ç—Ä–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞, –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –û–±—ã—á–Ω—ã–π (`/api/chat`) - multi-agent –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –°–∏—Å—Ç–µ–º–∞ —Å–∂–∞—Ç–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∫–∞–∫ –≤ Claude Code)

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª–∏–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤, —á—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã API.

**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–¢—Ä–∏–≥–≥–µ—Ä:** –ö–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
2. **–°–∂–∞—Ç–∏–µ:** –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤—Å–µ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ) –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è LLM —Å –ø—Ä–æ–º–ø—Ç–æ–º "—Å–æ–∂–º–∏ –≤ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ"
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∂–∞—Ç–æ–µ —Ä–µ–∑—é–º–µ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è 5-10x)
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö LLM –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   ```
   [system_prompt?, compressed_summary, last_message, new_message]
   ```
5. **UI:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è)

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Å–∂–∞—Ç–∏–µ:**
- **–£—Ä–æ–≤–µ–Ω—å 1:** –°–∂–∞—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ (–æ—Å–Ω–æ–≤–Ω–æ–µ)
- **–£—Ä–æ–≤–µ–Ω—å 2:** –°–∂–∞—Ç–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å)

**–ü—Ä–∏–º–µ—Ä:**
```
–ò—Å—Ö–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥ (15 —Å–æ–æ–±—â–µ–Ω–∏–π, 5000 —Ç–æ–∫–µ–Ω–æ–≤):
User: –ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â?
Assistant: –î–ª—è –±–æ—Ä—â–∞ –Ω—É–∂–Ω—ã —Å–≤–µ–∫–ª–∞, –∫–∞–ø—É—Å—Ç–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å...
User: –ê —Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏—Ç—å —Å–≤–µ–∫–ª—É?
Assistant: –°–≤–µ–∫–ª—É –≤–∞—Ä—è—Ç 40-60 –º–∏–Ω—É—Ç...
[–µ—â–µ 11 —Å–æ–æ–±—â–µ–Ω–∏–π]

‚Üì –°–∂–∞—Ç–∏–µ –ø–µ—Ä–≤—ã—Ö 10 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üì

–°–∂–∞—Ç–æ–µ —Ä–µ–∑—é–º–µ (200 —Ç–æ–∫–µ–Ω–æ–≤):
"–û–±—Å—É–∂–¥–∞–ª—Å—è —Ä–µ—Ü–µ–ø—Ç –±–æ—Ä—â–∞: –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã (—Å–≤–µ–∫–ª–∞, –∫–∞–ø—É—Å—Ç–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å),
–≤—Ä–µ–º—è –≤–∞—Ä–∫–∏ —Å–≤–µ–∫–ª—ã (40-60 –º–∏–Ω), –ø–æ—Ä—è–¥–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–≤–æ—â–µ–π."

–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM (700 —Ç–æ–∫–µ–Ω–æ–≤):
[system_prompt] + [compressed_summary] + [last_message] + [new_message]

–≠–∫–æ–Ω–æ–º–∏—è: 4300 —Ç–æ–∫–µ–Ω–æ–≤ (86%)
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- UI: –î–≤–∞ —Ç—É–º–±–ª–µ—Ä–∞ –≤ –≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- API: –ü–æ–ª—è `compressContext` –∏ `compressSystemPrompt` –≤ `ChatRequest`
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: –í—Ç–æ—Ä–æ–π —Ç—É–º–±–ª–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –≤–∫–ª—é—á–µ–Ω

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (–¥–æ 85-90% –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤)
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Å—Ç–∏ –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –±–µ–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ UI
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:**
- ‚ö†Ô∏è –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –¥–µ—Ç–∞–ª–µ–π –∏–∑ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–∂–∞—Ç–∏–µ (–Ω–æ –æ–±—â–∞—è —ç–∫–æ–Ω–æ–º–∏—è –±–æ–ª—å—à–µ)
- ‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ (–∫–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)

### OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API —Ñ–æ—Ä–º–∞—Ç
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API Yandex Cloud –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é Qwen.

**–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Endpoint: `/v1/chat/completions` (OpenAI ChatCompletion —Ñ–æ—Ä–º–∞—Ç)
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π: `{role: string, content: string}`
- –†–æ–ª–∏: "system", "user", "assistant" (—Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: `Authorization: Api-Key <YANDEX_API_KEY>`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```kotlin
OpenAIChatCompletionRequest(
    model = "qwen3-235b-a22b-fp8",
    messages = listOf(
        OpenAIMessage(role = "system", content = "–¢—ã - –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç"),
        OpenAIMessage(role = "user", content = "–ü—Ä–∏–≤–µ—Ç!")
    ),
    temperature = 0.6,
    maxTokens = 2000
)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ JSON Schema
LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–∞—Ä–∞–º–µ—Ç—Ä—É `response_format` —Å —Ç–∏–ø–æ–º `json_schema`:
```json
{"title":"–ö—Ä–∞—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫","message":"–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞"}
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –í –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `response_format` —Å JSON Schema –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
- API –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–º JSON –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç markdown –±–ª–æ–∫–æ–≤ –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥
- –û—Ç–≤–µ—Ç –ø–∞—Ä—Å–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `Json.decodeFromString()`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ß–∏—Å—Ç—ã–π JSON –±–µ–∑ markdown –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (```)
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ API
- ‚úÖ –ù–µ –Ω—É–∂–Ω—ã –∫–æ—Å—Ç—ã–ª–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `runCatching` –≤–º–µ—Å—Ç–æ try/catch (Kotlin idiomatic)
- –ï—Å–ª–∏ JSON –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª—Å—è - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è fallback —Å plain text
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Kotlin Code Style
1. **–ò—Å–ø–æ–ª—å–∑—É–π `runCatching` –≤–º–µ—Å—Ç–æ try/catch**
   ```kotlin
   // ‚ùå –ü–ª–æ—Ö–æ
   try {
       doSomething()
   } catch (e: Exception) {
       handleError(e)
   }

   // ‚úÖ –•–æ—Ä–æ—à–æ
   runCatching {
       doSomething()
   }.getOrElse { e ->
       handleError(e)
   }
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π expression-style —Ñ—É–Ω–∫—Ü–∏–∏ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ**
   ```kotlin
   // ‚úÖ –•–æ—Ä–æ—à–æ
   fun getStatus() = when {
       isReady -> "ready"
       else -> "not ready"
   }
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π scope functions (let, apply, run, etc)**
   ```kotlin
   // ‚úÖ –•–æ—Ä–æ—à–æ
   val result = sessions.getOrPut(sessionId) { mutableListOf() }
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π data classes –¥–ª—è –º–æ–¥–µ–ª–µ–π**
   - –í—Å–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `data class`
   - –ò—Å–ø–æ–ª—å–∑—É–π `@Serializable` –¥–ª—è JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏

5. **–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ä–æ–ª–µ–π (OpenAI —Ñ–æ—Ä–º–∞—Ç)**
   ```kotlin
   // ‚úÖ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç
   chatHistory.addMessage(sessionId, "user", "Hello")
   chatHistory.addMessage(sessionId, "assistant", "Hi there!")

   // –†–æ–ª–∏: "system", "user", "assistant" (—Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ)
   ```

6. **–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π**
   - –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ `suspend fun`
   - –ò—Å–ø–æ–ª—å–∑—É–π `runBlocking` —Ç–æ–ª—å–∫–æ –≤ main

### –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `println` (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ logger)
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `System.getenv()`
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ companion objects –∏–ª–∏ top-level

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
YANDEX_API_KEY=your_api_key_here

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
MODEL_NAME=qwen3-235b-a22b-fp8
API_ENDPOINT=https://llm.api.cloud.yandex.net/foundationModels/v1/chat/completions
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ Qwen –≤ Yandex Cloud:

**qwen3-235b-a22b-fp8 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):**
- ‚úÖ –ë–æ–ª—å—à–∞—è –º–æ–¥–µ–ª—å (235B –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON Schema
- ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –∫–æ–¥–æ–º –∏ —Å–ª–æ–∂–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- ‚ùå –î–æ—Ä–æ–∂–µ (0.50 —Ä—É–± –∑–∞ 1000 —Ç–æ–∫–µ–Ω–æ–≤)
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ

**qwen2-7b-instruct:**
- ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (7B –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ
- ‚úÖ –î–µ—à–µ–≤–ª–µ
- ‚ùå –•—É–∂–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏

### API Endpoint:
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π endpoint Yandex Cloud:
```
https://llm.api.cloud.yandex.net/foundationModels/v1/chat/completions
```

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `API_ENDPOINT`.

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ò–∑ IntelliJ IDEA (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ IntelliJ IDEA
2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –≤—ã–±–µ—Ä–∏—Ç–µ run configuration "Run Server" –∏–ª–∏ "Run (Gradle)"
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Run Configuration (Edit Configurations)
4. –ù–∞–∂–º–∏—Ç–µ Run (‚ñ∂Ô∏è)

### –ò–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export YANDEX_API_KEY=your_api_key_here

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É–∫–∞–∂–∏—Ç–µ –º–æ–¥–µ–ª—å –∏ endpoint (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ª–∏—á–Ω—ã–µ –æ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö)
export MODEL_NAME=qwen3-235b-a22b-fp8
export API_ENDPOINT=https://llm.api.cloud.yandex.net/foundationModels/v1/chat/completions

# –°–±–æ—Ä–∫–∞
./gradlew build

# –ó–∞–ø—É—Å–∫
./gradlew run
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:8080`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `MODEL_NAME` –∏ `API_ENDPOINT` –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (qwen3-235b-a22b-fp8 –∏ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π endpoint).

## API Endpoints

### GET /
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞

### GET /api/chats
**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ (–Ω–æ–≤–æ–µ!)**

**Response:**
```json
{
  "chats": [
    {
      "id": 1,
      "title": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ –∫–≤–∞–Ω—Ç–æ–≤–æ–π —Ñ–∏–∑–∏–∫–∏",
      "createdAt": 1715000000000,
      "updatedAt": 1715001000000
    }
  ]
}
```

### POST /api/chats
**–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ (–Ω–æ–≤–æ–µ!)**

**Request:**
```json
{
  "title": "–ù–æ–≤—ã–π —á–∞—Ç"
}
```

**Response (201 Created):**
```json
{
  "chatId": 42,
  "title": "–ù–æ–≤—ã–π —á–∞—Ç"
}
```

### DELETE /api/chats/{id}
**–£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ (–Ω–æ–≤–æ–µ!)**

**Response (200 OK):**
```json
{
  "success": true
}
```

**Response (404 Not Found):**
```json
{
  "error": "Chat not found"
}
```

### GET /api/chats/{id}/messages
**–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ (–Ω–æ–≤–æ–µ!)**

**Response:**
```json
{
  "messages": [
    {
      "id": 1,
      "chatId": 42,
      "role": "user",
      "content": "–ü—Ä–∏–≤–µ—Ç!",
      "timestamp": 1715000000000
    },
    {
      "id": 2,
      "chatId": 42,
      "role": "assistant",
      "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
      "timestamp": 1715000001000
    }
  ]
}
```

### POST /api/chat
**–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π multi-agent –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

**Request:**
```json
{
  "message": "—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "chatId": 42,
  "temperature": 0.6,
  "compressContext": false,
  "compressSystemPrompt": false
}
```

‚ö†Ô∏è **–ò–∑–º–µ–Ω–µ–Ω–æ:** –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `chatId: Int` –≤–º–µ—Å—Ç–æ `sessionId: String`

**Response:**
```json
{
  "response": "—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞",
  "title": "–∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç–≤–µ—Ç–∞",
  "isMultiAgent": false,
  "agents": null,
  "tokenUsage": {
    "inputTokens": 150,
    "outputTokens": 200,
    "totalTokens": 350,
    "estimatedCostRub": 0.28,
    "modelName": "yandexgpt"
  },
  "contextWindowUsage": {
    "currentTokens": 350,
    "maxTokens": 8000,
    "usagePercent": 4.38,
    "isCompressed": false
  }
}
```

**Multi-Agent Response:**
```json
{
  "response": "–∏—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ",
  "title": "–∑–∞–≥–æ–ª–æ–≤–æ–∫",
  "isMultiAgent": true,
  "agents": [
    {
      "role": "–§–∏–∑–∏–∫",
      "content": "–æ—Ç–≤–µ—Ç —Ñ–∏–∑–∏–∫–∞"
    },
    {
      "role": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫",
      "content": "–æ—Ç–≤–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
    }
  ],
  "tokenUsage": {...},
  "contextWindowUsage": {...}
}
```

### POST /api/chat/stream
**Streaming —Ä–µ–∂–∏–º** –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ (–±–µ–∑ multi-agent)

**Request:**
```json
{
  "message": "—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "chatId": 42
}
```

‚ö†Ô∏è **–ò–∑–º–µ–Ω–µ–Ω–æ:** –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `chatId: Int` –≤–º–µ—Å—Ç–æ `sessionId: String`

**Response:** Server-Sent Events (SSE)
```
data: {"chunk": "–ü—Ä–∏–≤–µ—Ç"}
data: {"chunk": ", –∫–∞–∫"}
data: {"chunk": " –¥–µ–ª–∞?"}
data: {"done": true}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Content-Type: `text/event-stream`
- –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ - —ç—Ç–æ JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{"chunk": "—Ç–µ–∫—Å—Ç"}`
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ - `{"done": true}`
- –û—à–∏–±–∫–∞ - `{"error": "–æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"}`

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ
- Kotlin 1.9+
- Ktor Server (Netty)
- Ktor Client (CIO)
- kotlinx.serialization

### Frontend
- marked.js - Markdown —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- highlight.js - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–¥–∞

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Thread Safety
- `ChatHistory` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ConcurrentHashMap` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–æ—Ä—É—Ç–∏–Ω
- –ö–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è —á–∞—Ç–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ `sessionId`

### –ü–∞—Ä—Å–∏–Ω–≥ JSON
1. –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –æ—Ç LLM –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç markdown —á–µ—Ä–µ–∑ `cleanJsonResponse()`
2. –ü–∞—Ä—Å–∏—Ç—Å—è —á–µ—Ä–µ–∑ `jsonParser.decodeFromString<LLMStructuredResponse>()`
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è fallback —Å plain text

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è production –Ω—É–∂–Ω–∞ –ë–î)
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API

## TODO / –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (–ë–î)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å rate limiting
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SLF4J
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (Prometheus)
- [ ] –î–æ–±–∞–≤–∏—Ç—å graceful shutdown
- [ ] –î–æ–±–∞–≤–∏—Ç—å docker-compose –¥–ª—è –¥–µ–ø–ª–æ—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (unit, integration)
