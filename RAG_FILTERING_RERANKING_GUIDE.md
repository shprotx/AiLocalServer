# RAG —Å–∏—Å—Ç–µ–º–∞ —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ Reranking

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
4. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∏-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
6. [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
7. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
8. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
9. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
10. [Troubleshooting](#troubleshooting)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

### –ß—Ç–æ —Ç–∞–∫–æ–µ RAG?

**RAG (Retrieval-Augmented Generation)** - —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏—è —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∑–Ω–∞–Ω–∏–π. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–Ω–∞–Ω–∏—è, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –≤–µ—Å–∞—Ö –º–æ–¥–µ–ª–∏, RAG –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—ë –≤ –ø—Ä–æ–º–ø—Ç.

### –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ reranking?

–ü—Ä–æ—Å—Ç–æ–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **–®—É–º**: –í —Ç–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–ø–∞–¥–∞—é—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏
- **–î—É–±–ª–∏–∫–∞—Ç—ã**: –ü–æ—Ö–æ–∂–∏–µ —á–∞–Ω–∫–∏ –∑–∞–Ω–∏–º–∞—é—Ç —Å–ª–æ—Ç—ã
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

**–ì–∏–±—Ä–∏–¥–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è + Reranking** —Ä–µ—à–∞–µ—Ç —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ü–µ—Ä–≤–∏—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–µ–∫–∞–µ—Ç —è–≤–Ω–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
2. **–£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã, –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä–æ–≥
3. **Reranking** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª–µ–µ –º–æ—â–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞**: +15-30% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤**: –ú–µ–Ω—å—à–µ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ = –º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: 3 —Ä–µ–∂–∏–º–∞ (default/strict/lenient) –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞ RAG –ø–∞–π–ø–ª–∞–π–Ω–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ó–ê–ü–†–û–°                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–∞ (bge-m3)                 ‚îÇ
‚îÇ   - –ú–æ–¥–µ–ª—å: bge-m3 (1.2 GB, 566.70M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)                 ‚îÇ
‚îÇ   - –í–µ–∫—Ç–æ—Ä: 1024 –∏–∑–º–µ—Ä–µ–Ω–∏—è                                      ‚îÇ
‚îÇ   - –í—Ä–µ–º—è: ~200-500ms                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 2: –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (Primary Filtering)              ‚îÇ
‚îÇ   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤ –∏–∑ –ë–î                                  ‚îÇ
‚îÇ   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ                 ‚îÇ
‚îÇ   - –§–∏–ª—å—Ç—Ä: similarity >= primaryThreshold (0.3)                ‚îÇ
‚îÇ   - –ë–µ—Ä–µ–º —Ç–æ–ø-N –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (initialCandidates = 20)             ‚îÇ
‚îÇ   –†–µ–∑—É–ª—å—Ç–∞—Ç: ~15-20 —á–∞–Ω–∫–æ–≤                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 3: –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (Smart Filtering)                    ‚îÇ
‚îÇ   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ–≥–æ –ø–æ—Ä–æ–≥–∞: similarity >= smartThreshold    ‚îÇ
‚îÇ   - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (Jaccard similarity > 70%)              ‚îÇ
‚îÇ   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é similarity                           ‚îÇ
‚îÇ   –†–µ–∑—É–ª—å—Ç–∞—Ç: ~8-12 —á–∞–Ω–∫–æ–≤                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 4: Reranking (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)                               ‚îÇ
‚îÇ   - –ú–æ–¥–µ–ª—å: nomic-embed-text (274 MB, 137M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)          ‚îÇ
‚îÇ   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è reranking —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞                  ‚îÇ
‚îÇ   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è reranking —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞           ‚îÇ
‚îÇ   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞ —Å reranking –≤–µ–∫—Ç–æ—Ä–∞–º–∏       ‚îÇ
‚îÇ   - –ü–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–æ–≤—ã–º —Å–∫–æ—Ä–∞–º                              ‚îÇ
‚îÇ   - –í–∑—è—Ç–∏–µ —Ç–æ–ø-K (rerankingTopK = 5)                            ‚îÇ
‚îÇ   –†–µ–∑—É–ª—å—Ç–∞—Ç: 5 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 5: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±–æ–≥–∞—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞                        ‚îÇ
‚îÇ   - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç                               ‚îÇ
‚îÇ   - –í—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ system prompt                           ‚îÇ
‚îÇ   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è LLM –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 6: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (Yandex GPT)                         ‚îÇ
‚îÇ   - LLM –ø–æ–ª—É—á–∞–µ—Ç –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç                              ‚îÇ
‚îÇ   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π                       ‚îÇ
‚îÇ   - –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
[User Query]
    ‚Üì (—Ç–µ–∫—Å—Ç)
[EmbeddingsManager]
    ‚Üì (—ç–º–±–µ–¥–¥–∏–Ω–≥ –≤–µ–∫—Ç–æ—Ä 1024D)
[VectorSearchManager]
    ‚Üì (SearchResultWithStats: results + filtering stats)
[RerankingManager] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    ‚Üì (RerankingResult: results + reranking stats)
[RAGManager]
    ‚Üì (RAGEnrichmentInfo: augmented messages + stats)
[YandexLLMClient]
    ‚Üì (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç)
[User]
```

### –î–≤—É—Ö–º–æ–¥–µ–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥

#### –ú–æ–¥–µ–ª—å 1: bge-m3 (–¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)
- **–†–∞–∑–º–µ—Ä**: 1.2 GB
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 566.70M
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è (multilingual)
  - –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è retrieval –∑–∞–¥–∞—á
  - –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

#### –ú–æ–¥–µ–ª—å 2: nomic-embed-text (–¥–ª—è reranking)
- **–†–∞–∑–º–µ—Ä**: 274 MB
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: 137M
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è
  - –£—á–∏—Ç—ã–≤–∞–µ—Ç –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  - –õ—É—á—à–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Ç–æ–Ω–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

**–ü–æ—á–µ–º—É –¥–≤–µ –º–æ–¥–µ–ª–∏?**
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –û–¥–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞, –¥—Ä—É–≥–∞—è –¥–ª—è —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: bge-m3 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —á–∞–Ω–∫–∏, nomic-embed-text —Ç–æ–ª—å–∫–æ —Ç–æ–ø –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- **–ö–∞—á–µ—Å—Ç–≤–æ**: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –¥–∞–µ—Ç –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. OllamaClient

**–§–∞–π–ª**: `src/main/kotlin/kz/shprot/OllamaClient.kt`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Ollama API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

**–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä**:
```kotlin
class OllamaClient(
    private val baseUrl: String = "http://localhost:11434",
    private val embeddingModel: String = "bge-m3",
    private val rerankingModel: String = "nomic-embed-text"
)
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:

```kotlin
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å
suspend fun generateEmbedding(
    text: String,
    modelOverride: String? = null
): List<Double>

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ reranking –º–æ–¥–µ–ª—å
suspend fun generateRerankingEmbedding(text: String): List<Double>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π (embeddings + reranking)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `runCatching`
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```kotlin
val ollamaClient = OllamaClient(
    embeddingModel = "bge-m3",
    rerankingModel = "nomic-embed-text"
)

// –î–ª—è –ø–æ–∏—Å–∫–∞
val searchEmbedding = ollamaClient.generateEmbedding("–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â?")

// –î–ª—è reranking
val rerankEmbedding = ollamaClient.generateRerankingEmbedding("–†–µ—Ü–µ–ø—Ç –±–æ—Ä—â–∞...")
```

---

### 2. VectorSearchManager

**–§–∞–π–ª**: `src/main/kotlin/kz/shprot/VectorSearchManager.kt`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**:

```kotlin
data class FilteringConfig(
    val initialCandidates: Int = 20,       // –¢–æ–ø-N –ø–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    val primaryThreshold: Double = 0.3,    // –ü–µ—Ä–≤–∏—á–Ω—ã–π –ø–æ—Ä–æ–≥ (–Ω–∏–∑–∫–∏–π)
    val smartThreshold: Double = 0.5,      // –£–º–Ω—ã–π –ø–æ—Ä–æ–≥ (–≤—ã—Å–æ–∫–∏–π)
    val topK: Int = 5,                     // –§–∏–Ω–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    val removeDuplicates: Boolean = true   // –£–¥–∞–ª—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
)
```

**–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã**:

| –†–µ–∂–∏–º | initialCandidates | primaryThreshold | smartThreshold | topK | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-------------------|------------------|----------------|------|----------|
| **DEFAULT** | 20 | 0.3 | 0.5 | 5 | –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á |
| **STRICT** | 15 | 0.4 | 0.65 | 3 | –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º –¥–ª—è –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **LENIENT** | 30 | 0.2 | 0.4 | 7 | –ú—è–≥–∫–∏–π —Ä–µ–∂–∏–º –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ |

**–ê–ª–≥–æ—Ä–∏—Ç–º –≥–∏–±—Ä–∏–¥–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**:

```kotlin
fun searchSimilarChunksWithStats(
    queryEmbedding: List<Double>,
    config: FilteringConfig = FilteringConfig.DEFAULT
): SearchResultWithStats {

    // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —á–∞–Ω–∫–∏
    val allChunks = databaseManager.getAllChunks()

    // 2. –í—ã—á–∏—Å–ª—è–µ–º —Å—Ö–æ–¥—Å—Ç–≤–æ –¥–ª—è –≤—Å–µ—Ö
    val allResults = allChunks.map { chunk ->
        SearchResult(
            chunk = chunk,
            similarity = cosineSimilarity(queryEmbedding, chunk.embedding)
        )
    }.sortedByDescending { it.similarity }

    // 3. –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    val primaryFiltered = allResults
        .filter { it.similarity >= config.primaryThreshold }
        .take(config.initialCandidates)

    // 4. –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    var smartFiltered = primaryFiltered
        .filter { it.similarity >= config.smartThreshold }

    // 5. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
    if (config.removeDuplicates) {
        smartFiltered = removeDuplicateChunks(smartFiltered)
    }

    // 6. –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–æ–ø-K
    val finalResults = smartFiltered.take(config.topK)

    return SearchResultWithStats(
        results = finalResults,
        stats = /* –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    )
}
```

**–£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**:

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Jaccard –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤:

```kotlin
private fun textSimilarity(text1: String, text2: String): Double {
    val words1 = text1.lowercase().split(Regex("\\s+")).toSet()
    val words2 = text2.lowercase().split(Regex("\\s+")).toSet()

    val intersection = words1.intersect(words2).size
    val union = words1.union(words2).size

    return intersection.toDouble() / union.toDouble()
}

// –ß–∞–Ω–∫–∏ —Å similarity > 0.7 —Å—á–∏—Ç–∞—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**:

```kotlin
data class FilteringStats(
    val totalChunks: Int,                    // –í—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤ –≤ –±–∞–∑–µ
    val afterPrimaryFilter: Int,             // –ü–æ—Å–ª–µ —ç—Ç–∞–ø–∞ 1
    val afterSmartFilter: Int,               // –ü–æ—Å–ª–µ —ç—Ç–∞–ø–∞ 2
    val finalResults: Int,                   // –§–∏–Ω–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    val avgSimilarityBefore: Double,         // –°—Ä–µ–¥–Ω—è—è –¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    val avgSimilarityAfter: Double,          // –°—Ä–µ–¥–Ω—è—è –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    val minSimilarity: Double,               // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
    val maxSimilarity: Double,               // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
    val similarityDistribution: List<Double>,// –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    val processingTimeMs: Long,              // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    val filteringConfig: FilteringConfig     // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
)
```

---

### 3. RerankingManager

**–§–∞–π–ª**: `src/main/kotlin/kz/shprot/RerankingManager.kt`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è reranking —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞** —á–µ—Ä–µ–∑ nomic-embed-text
2. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞**:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è reranking —ç–º–±–µ–¥–¥–∏–Ω–≥
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Å –∑–∞–ø—Ä–æ—Å–æ–º
3. **–ü–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –Ω–æ–≤—ã–º —Å–∫–æ—Ä–∞–º
4. **–í–∑—è—Ç–∏–µ —Ç–æ–ø-K** –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥**:

```kotlin
suspend fun rerankResults(
    query: String,
    candidates: List<SearchResult>,
    topK: Int = 5
): RerankingResult {

    // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º reranking —ç–º–±–µ–¥–¥–∏–Ω–≥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
    val queryEmbedding = ollamaClient.generateRerankingEmbedding(query)

    // 2. –ü–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç
    val rerankedResults = candidates.mapNotNull { candidate ->
        val chunkEmbedding = ollamaClient.generateRerankingEmbedding(
            candidate.chunk.content
        )

        val rerankScore = cosineSimilarity(queryEmbedding, chunkEmbedding)

        RerankingSearchResult(
            chunk = candidate.chunk,
            originalSimilarity = candidate.similarity,
            rerankScore = rerankScore
        )
    }

    // 3. –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ rerank —Å–∫–æ—Ä—É –∏ –±–µ—Ä–µ–º —Ç–æ–ø-K
    val topResults = rerankedResults
        .sortedByDescending { it.rerankScore }
        .take(topK)

    // 4. –í—ã—á–∏—Å–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    val stats = RerankingStats(
        totalCandidates = candidates.size,
        rerankedCount = rerankedResults.size,
        avgScoreBefore = candidates.map { it.similarity }.average(),
        avgScoreAfter = rerankedResults.map { it.rerankScore }.average(),
        scoreImprovement = /* –ø—Ä–æ—Ü–µ–Ω—Ç —É–ª—É—á—à–µ–Ω–∏—è */,
        processingTimeMs = /* –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ */
    )

    return RerankingResult(results = topResults, stats = stats)
}
```

**–ö–æ–≥–¥–∞ reranking –¥–∞–µ—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π —ç—Ñ—Ñ–µ–∫—Ç?**

- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–æ–π
- ‚úÖ –ú–Ω–æ–≥–æ–∞—Å–ø–µ–∫—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- ‚úÖ –ö–æ–≥–¥–∞ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω–æ
- ‚ùå –ü—Ä–æ—Å—Ç—ã–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (overhead –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–ª–∏—à–Ω–∏–º)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ reranking**:

```kotlin
data class RerankingStats(
    val totalCandidates: Int,       // –ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –≤—Ö–æ–¥–µ
    val rerankedCount: Int,          // –£—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–æ
    val avgScoreBefore: Double,      // –°—Ä–µ–¥–Ω–∏–π —Å–∫–æ—Ä –¥–æ reranking
    val avgScoreAfter: Double,       // –°—Ä–µ–¥–Ω–∏–π —Å–∫–æ—Ä –ø–æ—Å–ª–µ reranking
    val scoreImprovement: Double,    // –£–ª—É—á—à–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    val processingTimeMs: Long       // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
)
```

---

### 4. RAGManager

**–§–∞–π–ª**: `src/main/kotlin/kz/shprot/RAGManager.kt`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ RAG –ø–∞–π–ø–ª–∞–π–Ω–∞

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

```kotlin
data class RAGConfig(
    val filteringConfig: VectorSearchManager.FilteringConfig = FilteringConfig.DEFAULT,
    val useReranking: Boolean = true,
    val rerankingTopK: Int = 5
)
```

**–ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥**:

```kotlin
suspend fun augmentPromptWithKnowledgeDetailed(
    userQuery: String,
    originalMessages: List<Message>,
    config: RAGConfig = RAGConfig()
): RAGEnrichmentInfo {

    // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥ —á–µ—Ä–µ–∑ bge-m3
    val queryEmbedding = embeddingsManager.generateQueryEmbedding(userQuery)

    // 2. –ì–∏–±—Ä–∏–¥–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    val searchResultWithStats = vectorSearchManager.searchSimilarChunksWithStats(
        queryEmbedding,
        config.filteringConfig
    )

    var searchResults = searchResultWithStats.results
    var rerankingStats: RerankingStats? = null

    // 3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π reranking
    if (config.useReranking && searchResults.isNotEmpty()) {
        val rerankingResult = rerankingManager.rerankResults(
            query = userQuery,
            candidates = searchResults,
            topK = config.rerankingTopK
        )
        searchResults = rerankingResult.results
        rerankingStats = rerankingResult.stats
    }

    // 4. –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    val relevantContext = searchResults.joinToString("\n\n") { it.chunk.content }

    // 5. –°–æ–∑–¥–∞–µ–º –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    val augmentedMessages = buildAugmentedMessages(originalMessages, relevantContext)

    return RAGEnrichmentInfo(
        augmentedMessages = augmentedMessages,
        ragUsed = true,
        ragContext = relevantContext,
        chunksCount = searchResults.size,
        similarityScores = searchResults.map { it.similarity },
        filteringStats = searchResultWithStats.stats,
        rerankingStats = rerankingStats
    )
}
```

**–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±–æ–≥–∞—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞**:

```kotlin
private fun buildAugmentedMessages(
    originalMessages: List<Message>,
    knowledgeContext: String
): List<Message> {

    // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π system prompt
    val systemMessageIndex = originalMessages.indexOfFirst { it.role == "system" }

    if (systemMessageIndex >= 0) {
        // –î–æ–ø–æ–ª–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
        val existingSystemMessage = originalMessages[systemMessageIndex]
        val augmentedSystemPrompt = """
            ${existingSystemMessage.text}

            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
            üìö –ö–û–ù–¢–ï–ö–°–¢ –ò–ó –ë–ê–ó–´ –ó–ù–ê–ù–ò–ô
            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            $knowledgeContext

            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            –í–ê–ñ–ù–û: –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            –£–ñ–ï –ù–ê–•–û–î–ò–¢–°–Ø –í–´–®–ï –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–û–ù–¢–ï–ö–°–¢ –ò–ó –ë–ê–ó–´ –ó–ù–ê–ù–ò–ô".

            –ò–ù–°–¢–†–£–ö–¶–ò–Ø:
            1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã—à–µ
            2. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
            3. –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π –∏ –ù–ï –ø—Ä–æ—Å–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç - –æ–Ω —É–∂–µ –µ—Å—Ç—å
            4. –û—Ç–≤–µ—á–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            5. –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - —Ç–∞–∫ –∏ —Å–∫–∞–∂–∏
        """.trimIndent()

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
        return listOf(Message("system", augmentedSystemPrompt)) +
               originalMessages.filterIndexed { index, _ -> index != systemMessageIndex }
    } else {
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π system prompt —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        val newSystemPrompt = """
            –¢—ã - –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.

            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
            üìö –ö–û–ù–¢–ï–ö–°–¢ –ò–ó –ë–ê–ó–´ –ó–ù–ê–ù–ò–ô
            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            $knowledgeContext

            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏...]
        """.trimIndent()

        return listOf(Message("system", newSystemPrompt)) + originalMessages
    }
}
```

---

### 5. API –º–æ–¥–µ–ª–∏ (WebApiModels.kt)

**–§–∞–π–ª**: `src/main/kotlin/kz/shprot/models/WebApiModels.kt`

**–ó–∞–ø—Ä–æ—Å —á–∞—Ç–∞**:

```kotlin
@Serializable
data class ChatRequest(
    val message: String,
    val chatId: Int,
    val temperature: Double? = 0.6,
    val compressContext: Boolean = false,
    val compressSystemPrompt: Boolean = false,
    val useRAG: Boolean = true,
    val ragFilterMode: String = "default",  // "default" | "strict" | "lenient"
    val useReranking: Boolean = true
)
```

**–û—Ç–≤–µ—Ç —á–∞—Ç–∞**:

```kotlin
@Serializable
data class ChatResponse(
    val response: String,
    val title: String? = null,
    val isMultiAgent: Boolean = false,
    val agents: List<AgentResponseData>? = null,
    val tokenUsage: TokenUsageInfo? = null,
    val contextWindowUsage: ContextWindowUsage? = null,
    val usedTools: List<String>? = null,
    val ragUsed: Boolean = false,
    val ragContext: String? = null,
    val ragChunksCount: Int? = null,
    val ragFilteringStats: RAGFilteringStatsData? = null,
    val ragRerankingStats: RAGRerankingStatsData? = null
)
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**:

```kotlin
@Serializable
data class RAGFilteringStatsData(
    val totalChunks: Int,
    val afterPrimaryFilter: Int,
    val afterSmartFilter: Int,
    val finalResults: Int,
    val avgSimilarityBefore: Double,
    val avgSimilarityAfter: Double,
    val minSimilarity: Double,
    val maxSimilarity: Double,
    val processingTimeMs: Long
)
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ reranking**:

```kotlin
@Serializable
data class RAGRerankingStatsData(
    val totalCandidates: Int,
    val rerankedCount: Int,
    val avgScoreBefore: Double,
    val avgScoreAfter: Double,
    val scoreImprovement: Double,
    val processingTimeMs: Long
)
```

**–ó–∞–ø—Ä–æ—Å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è**:

```kotlin
@Serializable
data class CompareRequest(
    val message: String,
    val chatId: Int,
    val temperature: Double? = 0.6,
    val compressContext: Boolean = false,
    val compressSystemPrompt: Boolean = false,
    val ragFilterMode: String = "default",
    val useReranking: Boolean = true
)
```

**–û—Ç–≤–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è**:

```kotlin
@Serializable
data class CompareResponse(
    val withRAG: ChatResponse,
    val withoutRAG: ChatResponse,
    val ragContext: String?,
    val ragChunksCount: Int,
    val similarityScores: List<Double>? = null,
    val filteringStats: RAGFilteringStatsData? = null,
    val rerankingStats: RAGRerankingStatsData? = null
)
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ

**–§–æ—Ä–º—É–ª–∞**:

```
cos(Œ∏) = (A ¬∑ B) / (||A|| * ||B||)
```

–≥–¥–µ:
- `A ¬∑ B` - —Å–∫–∞–ª—è—Ä–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤
- `||A||` - –Ω–æ—Ä–º–∞ (–¥–ª–∏–Ω–∞) –≤–µ–∫—Ç–æ—Ä–∞ A
- `||B||` - –Ω–æ—Ä–º–∞ –≤–µ–∫—Ç–æ—Ä–∞ B

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

```kotlin
private fun cosineSimilarity(vec1: List<Double>, vec2: List<Double>): Double {
    require(vec1.size == vec2.size) { "–í–µ–∫—Ç–æ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏" }

    // –°–∫–∞–ª—è—Ä–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
    val dotProduct = vec1.zip(vec2).sumOf { (a, b) -> a * b }

    // –ù–æ—Ä–º—ã –≤–µ–∫—Ç–æ—Ä–æ–≤
    val norm1 = sqrt(vec1.sumOf { it * it })
    val norm2 = sqrt(vec2.sumOf { it * it })

    // –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
    return if (norm1 > 0 && norm2 > 0) {
        dotProduct / (norm1 * norm2)
    } else {
        0.0
    }
}
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π**:

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è | –î–µ–π—Å—Ç–≤–∏–µ |
|----------|---------------|----------|
| 1.0 | –ü–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | –ò–¥–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
| 0.7-0.9 | –í—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ |
| 0.5-0.7 | –°—Ä–µ–¥–Ω—è—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å | –í–æ–∑–º–æ–∂–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ |
| 0.3-0.5 | –ù–∏–∑–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å | –ì—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—Å–µ—á–µ–Ω–∏—è |
| < 0.3 | –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ | –û—Ç—Å–µ–∫–∞–µ—Ç—Å—è |

### Jaccard –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

**–§–æ—Ä–º—É–ª–∞**:

```
J(A, B) = |A ‚à© B| / |A ‚à™ B|
```

–≥–¥–µ:
- `A ‚à© B` - –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤ (–æ–±—â–∏–µ —Å–ª–æ–≤–∞)
- `A ‚à™ B` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤ (–≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞)

**–ü—Ä–∏–º–µ—Ä**:

```
–¢–µ–∫—Å—Ç 1: "–∫–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â —Å –∫–∞–ø—É—Å—Ç–æ–π"
–¢–µ–∫—Å—Ç 2: "–∫–∞–∫ —Å–≤–∞—Ä–∏—Ç—å –±–æ—Ä—â —Å –∫–∞–ø—É—Å—Ç–æ–π"

–°–ª–æ–≤–∞ 1: {–∫–∞–∫, –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å, –±–æ—Ä—â, —Å, –∫–∞–ø—É—Å—Ç–æ–π}
–°–ª–æ–≤–∞ 2: {–∫–∞–∫, —Å–≤–∞—Ä–∏—Ç—å, –±–æ—Ä—â, —Å, –∫–∞–ø—É—Å—Ç–æ–π}

–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: {–∫–∞–∫, –±–æ—Ä—â, —Å, –∫–∞–ø—É—Å—Ç–æ–π} = 4 —Å–ª–æ–≤–∞
–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ: {–∫–∞–∫, –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å, —Å–≤–∞—Ä–∏—Ç—å, –±–æ—Ä—â, —Å, –∫–∞–ø—É—Å—Ç–æ–π} = 6 —Å–ª–æ–≤

J = 4/6 = 0.67

0.67 < 0.7 ‚Üí –ù–ï –¥—É–±–ª–∏–∫–∞—Ç (–±–ª–∏–∑–∫–æ –∫ –ø–æ—Ä–æ–≥—É, –Ω–æ —Ä–∞–∑–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã)
```

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

Ollama –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (–¥–ª–∏–Ω–∞ –≤–µ–∫—Ç–æ—Ä–∞ = 1), —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞:

```kotlin
// –î–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤:
cosineSimilarity(a, b) = dotProduct(a, b)

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
val norm = sqrt(embedding.sumOf { it * it })
println("–ù–æ—Ä–º–∞ –≤–µ–∫—Ç–æ—Ä–∞: $norm")  // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚âà 1.0
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –†–µ–∂–∏–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

#### Default (—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```kotlin
FilteringConfig(
    initialCandidates = 20,
    primaryThreshold = 0.3,
    smartThreshold = 0.5,
    topK = 5,
    removeDuplicates = true
)
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –û—Ç—Å–µ–∫–∞–µ—Ç —è–≤–Ω–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
- –°—Ä–µ–¥–Ω—è—è —Å—Ç—Ä–æ–≥–æ—Å—Ç—å
- –•–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**: "–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â?"

#### Strict (—Å—Ç—Ä–æ–≥–∏–π)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –î–ª—è —Ç–æ—á–Ω—ã—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```kotlin
FilteringConfig(
    initialCandidates = 15,
    primaryThreshold = 0.4,
    smartThreshold = 0.65,
    topK = 3,
    removeDuplicates = true
)
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –í—ã—Å–æ–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –æ—Ç—Å–µ—á–µ–Ω–∏—è
- –ú–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω–æ –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã—Ö
- –ú–∏–Ω–∏–º—É–º —à—É–º–∞
- –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∫–æ—Å–≤–µ–Ω–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**: "–ö–∞–∫–æ–≤–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∏–ø–µ–Ω–∏—è –≤–æ–¥—ã –Ω–∞ –≤—ã—Å–æ—Ç–µ 2000–º?"

#### Lenient (–º—è–≥–∫–∏–π)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –î–ª—è —à–∏—Ä–æ–∫–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```kotlin
FilteringConfig(
    initialCandidates = 30,
    primaryThreshold = 0.2,
    smartThreshold = 0.4,
    topK = 7,
    removeDuplicates = true
)
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ù–∏–∑–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –æ—Ç—Å–µ—á–µ–Ω–∏—è
- –ë–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–æ—Å–≤–µ–Ω–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
- –í–æ–∑–º–æ–∂–µ–Ω –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —à—É–º

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**: "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –∏—Å—Ç–æ—Ä–∏—é –∫—É–ª–∏–Ω–∞—Ä–∏–∏"

### –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Default | Strict | Lenient |
|----------|---------|--------|---------|
| –ù–∞—á–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ | 20 | 15 | 30 |
| –ü–µ—Ä–≤–∏—á–Ω—ã–π –ø–æ—Ä–æ–≥ | 0.3 | 0.4 | 0.2 |
| –£–º–Ω—ã–π –ø–æ—Ä–æ–≥ | 0.5 | 0.65 | 0.4 |
| –§–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | 5 | 3 | 7 |
| –¢–æ—á–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê |
| –û—Ö–≤–∞—Ç | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| –°–∫–æ—Ä–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |

### Reranking –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä `useReranking`**:
- `true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –í–∫–ª—é—á–∏—Ç—å reranking —á–µ—Ä–µ–∑ nomic-embed-text
- `false`: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä `rerankingTopK`**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ reranking
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 3-7

**–ö–æ–≥–¥–∞ –æ—Ç–∫–ª—é—á–∞—Ç—å reranking**:
- ‚ùå –ü—Ä–æ—Å—Ç—ã–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚ùå –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –±–æ–ª—å—à–µ —Ç–æ—á–Ω–æ—Å—Ç–∏
- ‚ùå –†–µ—Å—É—Ä—Å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (CPU/RAM)

**–ö–æ–≥–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞—Ç—å**:
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ú–Ω–æ–≥–æ–∞—Å–ø–µ–∫—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- ‚úÖ –ö–æ–≥–¥–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∫—Ä–∏—Ç–∏—á–Ω–æ

---

## API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### POST /api/chat

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π RAG

**Request Body**:
```json
{
  "message": "–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å RAG —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é?",
  "chatId": 1,
  "temperature": 0.6,
  "compressContext": false,
  "compressSystemPrompt": false,
  "useRAG": true,
  "ragFilterMode": "default",
  "useReranking": true
}
```

**Response** (200 OK):
```json
{
  "response": "–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RAG —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä ragFilterMode...",
  "title": "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ RAG",
  "ragUsed": true,
  "ragContext": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤...",
  "ragChunksCount": 5,
  "ragFilteringStats": {
    "totalChunks": 150,
    "afterPrimaryFilter": 18,
    "afterSmartFilter": 10,
    "finalResults": 5,
    "avgSimilarityBefore": 0.42,
    "avgSimilarityAfter": 0.68,
    "minSimilarity": 0.52,
    "maxSimilarity": 0.85,
    "processingTimeMs": 45
  },
  "ragRerankingStats": {
    "totalCandidates": 5,
    "rerankedCount": 5,
    "avgScoreBefore": 0.68,
    "avgScoreAfter": 0.73,
    "scoreImprovement": 7.35,
    "processingTimeMs": 1250
  },
  "tokenUsage": {
    "inputTokens": 450,
    "outputTokens": 320,
    "totalTokens": 770,
    "estimatedCostRub": 0.62,
    "modelName": "yandexgpt"
  }
}
```

### POST /api/chat/compare

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å RAG –∏ –±–µ–∑ RAG

**Request Body**:
```json
{
  "message": "–ß—Ç–æ —Ç–∞–∫–æ–µ –≥–∏–±—Ä–∏–¥–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è?",
  "chatId": 1,
  "temperature": 0.6,
  "ragFilterMode": "strict",
  "useReranking": true
}
```

**Response** (200 OK):
```json
{
  "withRAG": {
    "response": "–ì–∏–±—Ä–∏–¥–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è - —ç—Ç–æ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å...",
    "ragUsed": true,
    "ragChunksCount": 3
  },
  "withoutRAG": {
    "response": "–ì–∏–±—Ä–∏–¥–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å...",
    "ragUsed": false
  },
  "ragContext": "–î–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...",
  "ragChunksCount": 3,
  "similarityScores": [0.85, 0.78, 0.72],
  "filteringStats": { /* ... */ },
  "rerankingStats": { /* ... */ }
}
```

### POST /api/knowledge-base/upload

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π

**Request**: multipart/form-data
- `file`: —Ñ–∞–π–ª (.txt, .md, .pdf)

**Response** (201 Created):
```json
{
  "success": true,
  "documentId": 42,
  "filename": "RAG_GUIDE.md",
  "message": "–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (245 —á–∞–Ω–∫–æ–≤)"
}
```

### GET /api/knowledge-base/stats

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

**Response** (200 OK):
```json
{
  "totalDocuments": 15,
  "totalChunks": 1850,
  "documents": [
    {
      "id": 1,
      "filename": "RAG_GUIDE.md",
      "fileType": "md",
      "uploadDate": 1715000000000,
      "totalChunks": 245
    }
  ]
}
```

### DELETE /api/knowledge-base/documents/{id}

**–û–ø–∏—Å–∞–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

**Response** (200 OK):
```json
{
  "success": true,
  "message": "–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Default —Ä–µ–∂–∏–º–æ–º

**–ó–∞–ø—Ä–æ—Å**:
```bash
curl -X POST http://localhost:8080/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç reranking –≤ RAG?",
    "chatId": 1,
    "useRAG": true,
    "ragFilterMode": "default",
    "useReranking": true
  }'
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. –ó–∞–ø—Ä–æ—Å "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç reranking –≤ RAG?" ‚Üí bge-m3 ‚Üí —ç–º–±–µ–¥–¥–∏–Ω–≥ 1024D
2. –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ: 150 —á–∞–Ω–∫–æ–≤ ‚Üí –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
3. –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: similarity >= 0.3, —Ç–æ–ø-20 ‚Üí 18 —á–∞–Ω–∫–æ–≤
4. –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: similarity >= 0.5, –¥—É–±–ª–∏–∫–∞—Ç—ã ‚Üí 10 —á–∞–Ω–∫–æ–≤
5. Reranking: nomic-embed-text ‚Üí 5 –ª—É—á—à–∏—Ö —á–∞–Ω–∫–æ–≤
6. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Üí –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç ‚Üí Yandex GPT
7. –û—Ç–≤–µ—Ç —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- 5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–∞ –ø–æ—Å–ª–µ reranking: +5-15%
- –û—Ç–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä 2: Strict —Ä–µ–∂–∏–º –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

**–ó–∞–ø—Ä–æ—Å**:
```javascript
const response = await fetch('/api/chat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    message: '–ö–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É FilteringConfig.STRICT?',
    chatId: 1,
    ragFilterMode: 'strict',
    useReranking: true
  })
});
```

**–ü–æ—á–µ–º—É Strict**:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
- –õ—É—á—à–µ 2-3 —Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, —á–µ–º 5-7 —Å —à—É–º–æ–º

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:
```json
{
  "filteringStats": {
    "totalChunks": 150,
    "afterPrimaryFilter": 12,
    "afterSmartFilter": 5,
    "finalResults": 3,
    "avgSimilarityBefore": 0.38,
    "avgSimilarityAfter": 0.78
  }
}
```

### –ü—Ä–∏–º–µ—Ä 3: Lenient —Ä–µ–∂–∏–º –¥–ª—è —à–∏—Ä–æ–∫–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

**Kotlin –∫–æ–¥**:
```kotlin
val ragConfig = RAGManager.RAGConfig(
    filteringConfig = VectorSearchManager.FilteringConfig.LENIENT,
    useReranking = true,
    rerankingTopK = 7
)

val enrichmentInfo = ragManager.augmentPromptWithKnowledgeDetailed(
    userQuery = "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É RAG —Å–∏—Å—Ç–µ–º",
    originalMessages = listOf(Message("system", "–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ RAG")),
    config = ragConfig
)
```

**–ü–æ—á–µ–º—É Lenient**:
- –®–∏—Ä–æ–∫–∏–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å
- –ù—É–∂–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç —Ç–µ–º—ã
- –û–∂–∏–¥–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:
```json
{
  "filteringStats": {
    "totalChunks": 150,
    "afterPrimaryFilter": 28,
    "afterSmartFilter": 15,
    "finalResults": 7,
    "avgSimilarityBefore": 0.35,
    "avgSimilarityAfter": 0.55
  }
}
```

### –ü—Ä–∏–º–µ—Ä 4: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å/–±–µ–∑ RAG

**UI –∫–æ–¥** (JavaScript):
```javascript
async function compareRAGModes() {
  const response = await fetch('/api/chat/compare', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      message: '–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ?',
      chatId: 1,
      ragFilterMode: 'default',
      useReranking: true
    })
  });

  const data = await response.json();

  console.log('–° RAG:', data.withRAG.response);
  console.log('–ë–µ–∑ RAG:', data.withoutRAG.response);
  console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —á–∞–Ω–∫–æ–≤:', data.ragChunksCount);
  console.log('–£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–∞:', data.rerankingStats.scoreImprovement + '%');
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
- **–° RAG**: –¢–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç —Å —Ñ–æ—Ä–º—É–ª–æ–π –∏ –¥–µ—Ç–∞–ª—è–º–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ë–µ–∑ RAG**: –û–±—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–Ω–∞–Ω–∏–π –º–æ–¥–µ–ª–∏
- **–†–∞–∑–Ω–∏—Ü–∞**: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å, –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å, –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è

### –ü—Ä–∏–º–µ—Ä 5: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ reranking –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏

**–ó–∞–ø—Ä–æ—Å**:
```json
{
  "message": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
  "chatId": 1,
  "useRAG": true,
  "ragFilterMode": "default",
  "useReranking": false
}
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
- –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è/–æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- –ö–æ–≥–¥–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ—Ç–ª–∞–¥–∫–∞

**–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏**:
- –ë–µ–∑ reranking: ~50-100ms
- –° reranking: ~1200-1500ms
- –†–∞–∑–Ω–∏—Ü–∞: **~12-15x –±—ã—Å—Ç—Ä–µ–µ**

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### Benchmark —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–¢–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π**: 150 —á–∞–Ω–∫–æ–≤, —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä 500 —Ç–æ–∫–µ–Ω–æ–≤

| –≠—Ç–∞–ø | –í—Ä–µ–º—è (ms) | –î–æ–ª—è |
|------|------------|------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ (bge-m3) | 200-300 | 15% |
| –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è | 40-60 | 3% |
| Reranking (5 —á–∞–Ω–∫–æ–≤, nomic-embed-text) | 1200-1500 | 82% |
| **–ò—Ç–æ–≥–æ** | **1440-1860** | **100%** |

**–í—ã–≤–æ–¥—ã**:
- Reranking - —Å–∞–º–∞—è –¥–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è 6 —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π (in-memory –æ–ø–µ—Ä–∞—Ü–∏–∏)
- –û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è production

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**1000 —á–∞–Ω–∫–æ–≤**:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (~250ms)
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫: +20-30ms (–ª–∏–Ω–µ–π–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å O(n))
- Reranking: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (~1350ms, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–ø-K)
- **–ò—Ç–æ–≥–æ**: ~1650ms (+10%)

**10000 —á–∞–Ω–∫–æ–≤**:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫: +150-200ms
- Reranking: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–ò—Ç–æ–≥–æ**: ~1850ms (+25%)

**–í—ã–≤–æ–¥**: –°–∏—Å—Ç–µ–º–∞ —Ö–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ 10k —á–∞–Ω–∫–æ–≤ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

```kotlin
class EmbeddingCache {
    private val cache = ConcurrentHashMap<String, List<Double>>()
    private val maxSize = 1000

    suspend fun getOrGenerate(
        text: String,
        generator: suspend (String) -> List<Double>
    ): List<Double> {
        return cache.getOrPut(text) {
            if (cache.size >= maxSize) {
                // LRU eviction
                cache.remove(cache.keys.first())
            }
            generator(text)
        }
    }
}
```

**–≠—Ñ—Ñ–µ–∫—Ç**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

#### 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π reranking

```kotlin
val rerankedResults = candidates.map { candidate ->
    async {
        val chunkEmbedding = ollamaClient.generateRerankingEmbedding(
            candidate.chunk.content
        )
        RerankingSearchResult(/* ... */)
    }
}.awaitAll()
```

**–≠—Ñ—Ñ–µ–∫—Ç**: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ reranking –≤ ~N —Ä–∞–∑ (–≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU —è–¥–µ—Ä)

#### 3. –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è production —Å >100k —á–∞–Ω–∫–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î:

- **pgvector** (PostgreSQL —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- **Qdrant**
- **Milvus**
- **Weaviate**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (ANN - Approximate Nearest Neighbors)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º

#### 4. –ë–∞—Ç—á–∏–Ω–≥ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

```kotlin
suspend fun generateEmbeddingsBatch(texts: List<String>): List<List<Double>> {
    // Ollama –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞—Ç—á–∏–Ω–≥
    return ollamaClient.embedBatch(texts)
}
```

**–≠—Ñ—Ñ–µ–∫—Ç**: –≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ HTTP overhead, —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2-3 —Ä–∞–∑–∞ –¥–ª—è –±–∞—Ç—á–µ–π

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–î–ª—è –º–∞–ª—ã—Ö –±–∞–∑ (<1000 —á–∞–Ω–∫–æ–≤)**:
- ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞
- ‚úÖ In-memory –ø–æ–∏—Å–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä
- ‚úÖ Reranking –æ–ø—Ä–∞–≤–¥–∞–Ω

**–î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –±–∞–∑ (1k-10k —á–∞–Ω–∫–æ–≤)**:
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π reranking
- ‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å RAM usage

**–î–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑ (>10k —á–∞–Ω–∫–æ–≤)**:
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (pgvector/Qdrant)
- ‚úÖ ANN –∏–Ω–¥–µ–∫—Å—ã –≤–º–µ—Å—Ç–æ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è bulk –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å reranking —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–ø –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

**VectorSearchManagerTest.kt**:

```kotlin
class VectorSearchManagerTest {

    @Test
    fun `test filtering modes produce different results`() {
        val manager = VectorSearchManager(testDb)
        val queryEmbedding = List(1024) { Random.nextDouble() }

        val defaultResults = manager.searchSimilarChunksWithStats(
            queryEmbedding,
            FilteringConfig.DEFAULT
        )

        val strictResults = manager.searchSimilarChunksWithStats(
            queryEmbedding,
            FilteringConfig.STRICT
        )

        // Strict –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        assertTrue(strictResults.results.size <= defaultResults.results.size)

        // Strict –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤—ã—à–µ —Å—Ä–µ–¥–Ω–∏–π similarity
        assertTrue(
            strictResults.stats.avgSimilarityAfter >=
            defaultResults.stats.avgSimilarityAfter
        )
    }

    @Test
    fun `test duplicate removal`() {
        val manager = VectorSearchManager(testDb)

        // –î–æ–±–∞–≤–ª—è–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —á–∞–Ω–∫–∏
        testDb.insertChunk("–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â")
        testDb.insertChunk("–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â —Ä–µ—Ü–µ–ø—Ç")

        val results = manager.searchSimilarChunksWithStats(
            queryEmbedding,
            FilteringConfig.DEFAULT
        )

        // –î—É–±–ª–∏–∫–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã
        assertTrue(results.stats.afterSmartFilter < results.stats.afterPrimaryFilter)
    }
}
```

**RerankingManagerTest.kt**:

```kotlin
class RerankingManagerTest {

    @Test
    fun `test reranking improves average score`() = runBlocking {
        val manager = RerankingManager(ollamaClient)

        val candidates = listOf(
            SearchResult(chunk1, similarity = 0.6),
            SearchResult(chunk2, similarity = 0.55),
            SearchResult(chunk3, similarity = 0.5)
        )

        val result = manager.rerankResults(
            query = "test query",
            candidates = candidates,
            topK = 2
        )

        // Reranking –¥–æ–ª–∂–µ–Ω —É–ª—É—á—à–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–π —Å–∫–æ—Ä
        assertTrue(result.stats.scoreImprovement > 0)

        // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–æ–≤–Ω–æ topK —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        assertEquals(2, result.results.size)
    }
}
```

### Integration —Ç–µ—Å—Ç—ã

**RAGPipelineTest.kt**:

```kotlin
class RAGPipelineTest {

    @Test
    fun `test full RAG pipeline end-to-end`() = runBlocking {
        // Setup
        val db = setupTestDatabase()
        db.insertDocument("Test document about RAG systems...")

        val ragManager = setupRAGManager(db)

        // Execute
        val result = ragManager.augmentPromptWithKnowledgeDetailed(
            userQuery = "What is RAG?",
            originalMessages = emptyList(),
            config = RAGConfig(
                filteringConfig = FilteringConfig.DEFAULT,
                useReranking = true
            )
        )

        // Assert
        assertTrue(result.ragUsed)
        assertTrue(result.chunksCount > 0)
        assertNotNull(result.ragContext)
        assertNotNull(result.filteringStats)
        assertNotNull(result.rerankingStats)

        // Verify statistics make sense
        with(result.filteringStats!!) {
            assertTrue(afterPrimaryFilter <= totalChunks)
            assertTrue(afterSmartFilter <= afterPrimaryFilter)
            assertTrue(finalResults <= afterSmartFilter)
        }
    }
}
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å –≤ Default —Ä–µ–∂–∏–º–µ
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –≤ Strict —Ä–µ–∂–∏–º–µ
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –≤ Lenient —Ä–µ–∂–∏–º–µ
5. –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   - Strict: –º–µ–Ω—å—à–µ —á–∞–Ω–∫–æ–≤, –≤—ã—à–µ similarity
   - Default: —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - Lenient: –±–æ–ª—å—à–µ —á–∞–Ω–∫–æ–≤, –Ω–∏–∂–µ similarity

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –í–ª–∏—è–Ω–∏–µ reranking**

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å —Å `useReranking: true`
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å —Å `useReranking: false`
3. –°—Ä–∞–≤–Ω–∏—Ç–µ:
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å reranking –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
   - –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–∞ (—Å reranking –ª—É—á—à–µ)
   - `scoreImprovement` –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å/–±–µ–∑ RAG**

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ endpoint `/api/chat/compare`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö:
   - –° RAG: —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π, –¥–µ—Ç–∞–ª—å–Ω—ã–π
   - –ë–µ–∑ RAG: –æ–±—â–∏–π, –≤–æ–∑–º–æ–∂–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π
3. –û—Ü–µ–Ω–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

**–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å**:
```
Precision@K = (–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤ —Ç–æ–ø-K) / K
```

**–ü—Ä–∏–º–µ—Ä**:
- –¢–æ–ø-5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: [—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π, –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π]
- Precision@5 = 4/5 = 0.8 = 80%

**Recall**:
```
Recall = (–ù–∞–π–¥–µ–Ω–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö) / (–í—Å–µ–≥–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤ –±–∞–∑–µ)
```

**MRR (Mean Reciprocal Rank)**:
```
MRR = 1 / (–ü–æ–∑–∏—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
```

**–ü—Ä–∏–º–µ—Ä**:
- –ü–µ—Ä–≤—ã–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ 2
- MRR = 1/2 = 0.5

### A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–∏–∑–∞–π–Ω —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞**:

1. **–ì—Ä—É–ø–ø–∞ A**: Default + reranking
2. **–ì—Ä—É–ø–ø–∞ B**: Strict + reranking
3. **–ì—Ä—É–ø–ø–∞ C**: Default –±–µ–∑ reranking

**–ú–µ—Ç—Ä–∏–∫–∏**:
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- Precision@5
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (1-5)

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** (–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ):

| –ì—Ä—É–ø–ø–∞ | –í—Ä–µ–º—è (ms) | Precision@5 | User Rating |
|--------|------------|-------------|-------------|
| A (Default + rerank) | 1500 | 0.82 | 4.2 |
| B (Strict + rerank) | 1450 | 0.88 | 4.5 |
| C (Default, no rerank) | 300 | 0.68 | 3.8 |

**–í—ã–≤–æ–¥**: Strict + reranking –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞, Default –±–µ–∑ reranking - –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Ollama –º–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

**–°–∏–º–ø—Ç–æ–º—ã**:
```
‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: Model not found
```

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏
ollama list

# –ï—Å–ª–∏ bge-m3 –Ω–µ—Ç - —Å–∫–∞—á–∞–π—Ç–µ
ollama pull bge-m3

# –ï—Å–ª–∏ nomic-embed-text –Ω–µ—Ç - —Å–∫–∞—á–∞–π—Ç–µ
ollama pull nomic-embed-text

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Ollama –∑–∞–ø—É—â–µ–Ω–∞
curl http://localhost:11434/api/tags
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Reranking —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π

**–°–∏–º–ø—Ç–æ–º—ã**:
```json
{
  "rerankingStats": {
    "processingTimeMs": 5000
  }
}
```

**–ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è**:

1. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è reranking**
   ```kotlin
   // –†–µ—à–µ–Ω–∏–µ: —É–º–µ–Ω—å—à–∏—Ç–µ topK –≤ VectorSearchManager
   val config = FilteringConfig(
       topK = 3  // –í–º–µ—Å—Ç–æ 5-7
   )
   ```

2. **Ollama –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É
   top | grep ollama

   # –†–µ—Å—Ç–∞—Ä—Ç—É–π—Ç–µ Ollama
   sudo systemctl restart ollama
   ```

3. **–ú–µ–¥–ª–µ–Ω–Ω—ã–π CPU**
   ```kotlin
   // –û—Ç–∫–ª—é—á–∏—Ç–µ reranking –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   if (isSimpleQuery(userQuery)) {
       ragConfig = ragConfig.copy(useReranking = false)
   }
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–°–∏–º–ø—Ç–æ–º—ã**: RAG –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```kotlin
// –í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
println("–¢–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:")
searchResults.forEachIndexed { index, result ->
    println("${index + 1}. Similarity: ${result.similarity}")
    println("   Content: ${result.chunk.content.take(100)}...")
}
```

**–†–µ—à–µ–Ω–∏—è**:

1. **–ü–æ–≤—ã—Å—å—Ç–µ –ø–æ—Ä–æ–≥–∏**
   ```kotlin
   val config = FilteringConfig.STRICT  // –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–∏–Ω–≥–∞**
   ```kotlin
   // –í–æ–∑–º–æ–∂–Ω–æ, —á–∞–Ω–∫–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ/–º–∞–ª–µ–Ω—å–∫–∏–µ
   val documentProcessor = DocumentProcessor(
       chunkSize = 500,  // –£–º–µ–Ω—å—à–∏—Ç–µ —Å 1000
       overlap = 100     // –£–º–µ–Ω—å—à–∏—Ç–µ —Å 200
   )
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**
   ```bash
   # –û–±–Ω–æ–≤–∏—Ç–µ –º–æ–¥–µ–ª—å bge-m3
   ollama pull bge-m3
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: OutOfMemoryError

**–°–∏–º–ø—Ç–æ–º—ã**:
```
java.lang.OutOfMemoryError: Java heap space
```

**–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —á–∞–Ω–∫–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ –ø–∞–º—è—Ç—å

**–†–µ—à–µ–Ω–∏—è**:

1. **–£–≤–µ–ª–∏—á—å—Ç–µ heap**
   ```bash
   ./gradlew run -Dorg.gradle.jvmargs="-Xmx4g"
   ```

2. **–£–º–µ–Ω—å—à–∏—Ç–µ initialCandidates**
   ```kotlin
   val config = FilteringConfig(
       initialCandidates = 10  // –í–º–µ—Å—Ç–æ 20
   )
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑**
   ```kotlin
   fun searchSimilarChunksStreaming(
       queryEmbedding: List<Double>,
       batchSize: Int = 1000
   ): Sequence<SearchResult> = sequence {
       var offset = 0
       while (true) {
           val batch = databaseManager.getChunksBatch(offset, batchSize)
           if (batch.isEmpty()) break

           yieldAll(batch.map { chunk ->
               SearchResult(chunk, cosineSimilarity(queryEmbedding, chunk.embedding))
           })

           offset += batchSize
       }
   }
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**: –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –º–Ω–æ–≥–æ –ø–æ—Ö–æ–∂–∏—Ö —á–∞–Ω–∫–æ–≤

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```kotlin
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä–æ–≥ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
smartFiltered.forEach { result ->
    smartFiltered.forEach { other ->
        if (result.chunk.id != other.chunk.id) {
            val sim = textSimilarity(result.chunk.content, other.chunk.content)
            println("Similarity between ${result.chunk.id} and ${other.chunk.id}: $sim")
        }
    }
}
```

**–†–µ—à–µ–Ω–∏—è**:

1. **–ü–æ–Ω–∏–∑—å—Ç–µ –ø–æ—Ä–æ–≥ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**
   ```kotlin
   private fun removeDuplicateChunks(chunks: List<SearchResult>): List<SearchResult> {
       val unique = mutableListOf<SearchResult>()
       for (chunk in chunks) {
           val isDuplicate = unique.any { existing ->
               val similarity = textSimilarity(existing.chunk.content, chunk.chunk.content)
               similarity > 0.6  // –ë—ã–ª–æ 0.7, —Å—Ç–∞–ª–æ 0.6
           }
           if (!isDuplicate) unique.add(chunk)
       }
       return unique
   }
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ —É–º–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**
   ```kotlin
   private fun removeDuplicateChunksAdvanced(chunks: List<SearchResult>): List<SearchResult> {
       val unique = mutableListOf<SearchResult>()

       for (chunk in chunks.sortedByDescending { it.similarity }) {
           val isDuplicate = unique.any { existing ->
               // –ü—Ä–æ–≤–µ—Ä—è–µ–º n-–≥—Ä–∞–º–º—ã –≤–º–µ—Å—Ç–æ —Å–ª–æ–≤
               val ngramSim = ngramSimilarity(existing.chunk.content, chunk.chunk.content, n = 3)
               ngramSim > 0.5
           }
           if (!isDuplicate) unique.add(chunk)
       }

       return unique
   }
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 6: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—É—Å—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã**:
```json
{
  "ragUsed": false,
  "ragContext": null,
  "ragChunksCount": 0
}
```

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã
curl http://localhost:8080/api/knowledge-base/stats

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
curl -X POST http://localhost:8080/api/knowledge-base/upload \
  -F "file=@RAG_GUIDE.md"
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü–µ—Ä–≤–∏—á–Ω–∞—è + —É–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

‚úÖ **Reranking —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å**: nomic-embed-text –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∏

‚úÖ **–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã**: Default/Strict/Lenient –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤

‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

‚úÖ **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ—Ä–æ–≥–∞–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

‚úÖ **Production-ready**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

- **+15-30%** —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **+5-15%** —É–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–∞ –ø–æ—Å–ª–µ reranking
- **-40-60%** —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

**–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ**:
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π reranking
- [ ] –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è bulk –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus)

**–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ**:
- [ ] –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (pgvector/Qdrant)
- [ ] ANN –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑
- [ ] Adaptive —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (ML –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ—Ä–æ–≥–æ–≤)
- [ ] Multi-query retrieval

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ**:
- [ ] Hybrid search (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + BM25)
- [ ] Cross-encoder reranking
- [ ] Query expansion
- [ ] Feedback loop –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

### –°—Å—ã–ª–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã

**–ú–æ–¥–µ–ª–∏**:
- [bge-m3](https://huggingface.co/BAAI/bge-m3) - Multilingual embedding model
- [nomic-embed-text](https://huggingface.co/nomic-ai/nomic-embed-text-v1) - Embedding –¥–ª—è reranking

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**:
- [Ollama](https://ollama.ai/) - –õ–æ–∫–∞–ª—å–Ω—ã–π inference –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- [Ktor](https://ktor.io/) - Kotlin –≤–µ–± —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- [kotlinx.serialization](https://github.com/Kotlin/kotlinx.serialization) - JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
- [Cosine Similarity](https://en.wikipedia.org/wiki/Cosine_similarity)
- [Jaccard Index](https://en.wikipedia.org/wiki/Jaccard_index)
- [Vector Search Best Practices](https://www.pinecone.io/learn/vector-search/)

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0
**–î–∞—Ç–∞**: 2025-01-27
**–ê–≤—Ç–æ—Ä—ã**: AI Local Server Team
**–õ–∏—Ü–µ–Ω–∑–∏—è**: MIT
